# Инструкция по развертыванию на хостинге

## Подготовка к развертыванию

1. **Убедитесь, что на сервере установлены:**
   - Docker
   - Docker Compose

2. **Загрузите проект на сервер:**
   ```bash
   # Через git
   git clone <your-repo-url>
   cd Eritrocit_ne_vinovat
   
   # Или через scp/sftp
   ```

## Запуск на хостинге

### Базовое развертывание (HTTP)

```bash
# Соберите и запустите контейнеры
docker-compose up -d --build

# Проверьте статус
docker-compose ps

# Просмотрите логи
docker-compose logs -f
```

### Настройка домена (DNS)

**Что такое DNS настройка?**

DNS (Domain Name System) — это система, которая связывает доменное имя (например, `mysite.com`) с IP-адресом вашего сервера.

**Как это сделать:**

1. **Узнайте IP-адрес вашего сервера:**
   ```bash
   # На сервере выполните:
   curl ifconfig.me
   # Или
   hostname -I
   ```

2. **Зайдите в панель управления вашим доменом** (где вы покупали домен, например: reg.ru, timeweb.com, namecheap.com и т.д.)

3. **Найдите раздел "DNS записи" или "Управление DNS"**

4. **Добавьте A-запись:**
   - **Имя/Хост:** `@` (или оставьте пустым) — это для основного домена `yourdomain.com`
   - **Тип:** `A`
   - **Значение/IP:** вставьте IP-адрес вашего сервера (который узнали в шаге 1)
   - **TTL:** оставьте по умолчанию (обычно 3600)

5. **Опционально, для www:**
   - **Имя/Хост:** `www`
   - **Тип:** `A`
   - **Значение/IP:** тот же IP-адрес сервера

6. **Сохраните изменения**

7. **Подождите 5-30 минут** (DNS изменения распространяются не мгновенно)

8. **Проверьте:**
   ```bash
   # На вашем компьютере:
   ping yourdomain.com
   # Должен показать IP вашего сервера
   ```

**Важно:** Nginx уже настроен для работы с любым доменом, поэтому после настройки DNS приложение будет доступно по адресу:
- `http://yourdomain.com/`
- `http://yourdomain.com/api/`

**Если у вас нет домена:**
Можно использовать IP-адрес напрямую: `http://YOUR_SERVER_IP/`

## Обслуживание

### Просмотр логов
```bash
# Все сервисы
docker-compose logs -f

# Только бэкенд
docker-compose logs -f backend

# Только фронтенд
docker-compose logs -f frontend
```

### Обновление приложения
```bash
# Остановите контейнеры
docker-compose down

# Обновите код (через git или загрузите новые файлы)

# Пересоберите и запустите
docker-compose up -d --build
```

### Остановка
```bash
docker-compose down
```

### Полная очистка (удаление образов)
```bash
docker-compose down --rmi all
```

## Безопасность

1. **Настройте файрвол:**
   ```bash
   # Разрешите только необходимые порты
   sudo ufw allow 80/tcp
   sudo ufw enable
   ```

2. **Ограничьте CORS** (опционально):
   - Отредактируйте `back/app/main.py`
   - Замените `allow_origins=["*"]` на конкретные домены

3. **Регулярно обновляйте Docker образы:**
   ```bash
   docker-compose pull
   docker-compose up -d --build
   ```

## Мониторинг

### Проверка здоровья сервисов
```bash
# Проверка бэкенда
curl http://yourdomain.com/health

# Проверка статуса контейнеров
docker-compose ps
```

### Резервное копирование данных
```bash
# Данные хранятся в ./back/data/
# Создайте резервную копию:
tar -czf backup-$(date +%Y%m%d).tar.gz back/data/
```

## Решение проблем

### Контейнеры не запускаются
```bash
# Проверьте логи
docker-compose logs

# Проверьте использование портов
sudo netstat -tulpn | grep :80
sudo netstat -tulpn | grep :8000
```

### Ошибки подключения к API
- Убедитесь, что контейнеры запущены: `docker-compose ps`
- Проверьте логи бэкенда: `docker-compose logs backend`
- Проверьте, что nginx проксирует запросы правильно


